<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema PMF</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0a1929;
            --secondary: #102a43;
            --accent: #0d47a1;
            --accent-light: #2196f3;
            --text: #f5f8fa;
            --text-secondary: #b3c5d2;
            --card-bg: #1a365d;
            --card-bg-dark: #152a4d;
            --success: #00b894;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: var(--primary);
            color: var(--text);
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styling */
        .sidebar {
            width: 260px;
            background: linear-gradient(to bottom, var(--secondary), var(--primary));
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100vh;
        }
        
        .sidebar-logo {
            display: flex;
            align-items: center;
            margin-bottom: 40px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-light), var(--accent));
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }
        
        .sidebar-logo h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .menu-item.active {
            background-color: var(--accent);
        }
        
        .menu-icon {
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
        }
        
        .sidebar-footer {
            margin-top: auto;
            padding-top: 20px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 20px 30px;
        }
        
        .header {
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
        }
        
        .header-content {
            z-index: 2;
            max-width: 60%;
        }
        
        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .header-decoration {
            position: absolute;
            right: -50px;
            top: 50%;
            transform: translateY(-50%);
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(33, 150, 243, 0.3) 0%, rgba(13, 71, 161, 0) 70%);
            border-radius: 50%;
            z-index: 1;
        }
        
        .header-decoration::before {
            content: '';
            position: absolute;
            width: 150px;
            height: 150px;
            top: 75px;
            left: 75px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 70%);
            border-radius: 50%;
        }
        
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: linear-gradient(145deg, var(--card-bg), var(--card-bg-dark));
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .card-title {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .card-value {
            font-size: 2.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .card-chart {
            flex: 1;
            height: 60px;
            width: 100%;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .chart-line {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: linear-gradient(to top left, transparent 0%, transparent 50%, var(--accent-light) 50%, var(--accent-light) 100%);
            opacity: 0.2;
        }
        
        .blue-card { border-left: 4px solid var(--accent-light); }
        .green-card { border-left: 4px solid var(--success); }
        .orange-card { border-left: 4px solid var(--warning); }
        .teal-card { border-left: 4px solid var(--info); }
        
        .section-container {
            margin-bottom: 30px;
            background: linear-gradient(145deg, var(--card-bg), var(--card-bg-dark));
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .section-header {
            background-color: var(--secondary);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .btn {
            background: linear-gradient(to right, var(--accent), var(--accent-light));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        
        .calendar-content {
            padding: 20px;
        }
        
        .calendar-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .month-display {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }
        
        .calendar-day-header {
            text-align: center;
            padding: 10px;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .calendar-day {
            aspect-ratio: 1;
            border-radius: 10px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            font-weight: 500;
            background-color: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            padding: 8px 5px;
            min-height: 110px;
            border-left: 4px solid transparent;
        }

        /* Guarnição styles */
        .guarnicao-alfa {
            border-color: #3498db; /* Azul para ALFA */
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .guarnicao-bravo {
            border-color: #f39c12; /* Amarelo para BRAVO */
            background-color: rgba(243, 156, 18, 0.1);
        }
        
        .guarnicao-charlie {
            border-color: #e74c3c; /* Vermelho para CHARLIE */
            background-color: rgba(231, 76, 60, 0.1);
        }
        
        .calendar-day:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }
        
        .calendar-day.active {
            background-color: var(--accent);
            color: white;
        }
        
        .calendar-day.has-events::after {
            content: '';
            position: absolute;
            bottom: 8px;
            width: 6px;
            height: 6px;
            background-color: var(--accent-light);
            border-radius: 50%;
        }

        .calendar-day-count {
            font-size: 0.7rem;
            color: var(--accent-light);
            margin-top: 3px;
            font-weight: bold;
        }

        .calendar-pm-names {
            font-size: 0.85rem;
            color: var(--text);
            text-align: center;
            margin-top: 5px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            width: 100%;
            overflow: hidden;
        }

        .calendar-pm-item {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .calendar-pm-item.soldier {
            border-left: 8px solid #3498db;
            background-color: rgba(52, 152, 219, 0.1);
        }

        .calendar-pm-item.officer {
            border-left: 8px solid #f39c12;
            background-color: rgba(243, 156, 18, 0.1);
        }

        .calendar-pm-item.captain {
            border-left: 8px solid #e74c3c;
            background-color: rgba(231, 76, 60, 0.1);
        }
        
        .calendar-pm-item.expedient {
            border-left: 8px solid #27ae60;
            background-color: rgba(39, 174, 96, 0.1);
        }
        
        .list-content {
            padding: 20px;
        }
        
        .list-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .filter-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text);
            font-size: 0.9rem;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .filter-input:focus {
            border-color: var(--accent-light);
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .filter-input::placeholder {
            color: var(--text-secondary);
        }
        
        .list-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
        }
        
        .list-table th {
            text-align: left;
            padding: 12px 20px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .list-table td {
            padding: 16px 20px;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .list-table tr td:first-child {
            border-radius: 8px 0 0 8px;
        }
        
        .list-table tr td:last-child {
            border-radius: 0 8px 8px 0;
        }
        
        .table-empty {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-secondary);
        }

        /* Conflict styles */
        .conflict-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background-color: rgba(243, 156, 18, 0.2);
            border-radius: 4px;
            padding: 4px 8px;
            color: var(--warning);
            font-weight: 600;
        }

        .no-conflicts-message {
            text-align: center;
            padding: 30px;
            color: var(--success);
            font-weight: 500;
            background-color: rgba(0, 184, 148, 0.1);
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .action-btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text);
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .action-btn.edit {
            background-color: rgba(52, 152, 219, 0.2);
        }
        
        .action-btn.delete {
            background-color: rgba(231, 76, 60, 0.2);
        }
        
        .rank-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: 500;
            background-color: var(--primary);
            margin-right: 8px;
            color: var(--text);
            min-width: 90px;
            text-align: center;
        }
        
        .rank-soldier {
            background-color: #3498db30;
            border-left: 8px solid #3498db;
            padding-left: 8px;
        }
        
        .rank-officer {
            background-color: #f39c1230;
            border-left: 8px solid #f39c12;
            padding-left: 8px;
        }
        
        .rank-captain {
            background-color: #e74c3c30;
            border-left: 8px solid #e74c3c;
            padding-left: 8px;
        }
        
        .rank-expedient {
            background-color: #27ae6030;
            border-left: 8px solid #27ae60;
            padding-left: 8px;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            cursor: pointer; /* Make overlay clickable */
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: linear-gradient(145deg, var(--card-bg), var(--card-bg-dark));
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            transform: translateY(-20px);
            transition: all 0.3s ease;
            overflow: hidden;
            cursor: default; /* Reset cursor for modal content */
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            background-color: var(--secondary);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .modal-close {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--text);
            font-size: 1.6rem;
            font-weight: bold;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(20, 39, 65, 0.8);
            color: var(--text);
            font-size: 0.9rem;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--accent-light);
            background-color: rgba(33, 64, 95, 0.8);
        }

        select.form-control option {
            background-color: var(--card-bg);
            color: var(--text);
        }
        
        /* Fix dropdown background color */
        .filter-input option {
            background-color: var(--card-bg);
            color: var(--text);
        }
        
        .modal-footer {
            padding: 15px 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Day Details Styles */
        .day-details-section {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: rgba(33, 64, 95, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .day-details-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }
        
        .day-details-pm-list {
            margin: 15px 0;
        }
        
        .day-details-pm-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            background-color: rgba(33, 64, 95, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .day-details-pm-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .day-details-limit-warning {
            color: var(--warning);
            padding: 10px;
            margin-top: 10px;
            text-align: center;
            border-radius: 6px;
            background-color: rgba(243, 156, 18, 0.1);
            border: 1px dashed var(--warning);
        }

        /* Loading animation */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 1000;
            animation: fadeOut 1s ease-out 2s forwards;
        }
        
        .loading-shield {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent-light), var(--accent));
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            position: relative;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        .loading-shield::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            background-color: var(--primary);
        }
        
        .loading-text {
            margin-top: 20px;
            font-size: 1.2rem;
            letter-spacing: 2px;
            animation: fadeInOut 1.5s ease-in-out infinite;
        }

        /* Views */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }
        
        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }

        /* Toast notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(to right, var(--accent), var(--accent-light));
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }

        .toast.success {
            background: linear-gradient(to right, #00b894, #00d1a0);
        }

        .toast.error {
            background: linear-gradient(to right, #e74c3c, #ff6b6b);
        }

        .toast.visible {
            transform: translateX(0);
        }

        /* Reports Tab Styles */
        .reports-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .report-card {
            background: linear-gradient(145deg, var(--card-bg), var(--card-bg-dark));
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }

        .report-card:hover {
            transform: translateY(-5px);
        }

        .report-header {
            background-color: var(--secondary);
            padding: 15px 20px;
        }

        .report-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-content {
            padding: 20px;
        }

        .report-metric {
            margin-bottom: 15px;
        }

        .metric-title {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .metric-subtitle {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .report-chart {
            height: 200px;
            margin: 20px 0 10px;
            position: relative;
        }
        
        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 160px;
            margin-bottom: 10px;
        }
        
        .chart-bar {
            width: 30px;
            background: linear-gradient(to top, var(--accent), var(--accent-light));
            border-radius: 3px 3px 0 0;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .chart-bar:hover {
            transform: scaleY(1.05);
            background: linear-gradient(to top, var(--accent-light), var(--accent));
        }
        
        .chart-bar-label {
            position: absolute;
            bottom: -20px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .chart-axis {
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 1px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .rank-breakdown {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .rank-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.05);
        }

        .rank-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .rank-name {
            font-size: 0.85rem;
            margin-right: 5px;
        }

        .rank-count {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent-light);
        }

        .report-table {
            width: 100%;
            margin-top: 15px;
        }

        .report-table th {
            text-align: left;
            padding: 8px 10px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.85rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .report-table td {
            padding: 10px;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .date-selector {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-selector label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .date-selector input, .date-selector select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(20, 39, 65, 0.8);
            color: var(--text);
            outline: none;
        }
        
        /* Busca Styles */
        .search-result-container {
            background: linear-gradient(145deg, var(--card-bg), var(--card-bg-dark));
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .search-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .search-result-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }
        
        #search-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .pm-result-card {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent);
        }
        
        .pm-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .pm-result-name {
            font-size: 1.1rem;
            margin: 0 0 5px 0;
        }
        
        .pm-result-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .pm-stat {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .pm-stat-label {
            color: var(--text-secondary);
            margin-right: 5px;
        }
        
        .pm-stat-value {
            font-weight: 600;
        }
        
        .pm-result-dates {
            margin-top: 15px;
        }
        
        .pm-result-dates h5 {
            font-size: 1rem;
            margin: 0 0 10px 0;
            color: var(--text-secondary);
        }
        
        .pm-dates-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .pm-date-item {
            background-color: rgba(255, 255, 255, 0.08);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.85rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
                padding: 20px 10px;
            }
            
            .sidebar-logo h1, 
            .menu-item span,
            .sidebar-footer {
                display: none;
            }
            
            .main-content {
                margin-left: 80px;
            }
            
            .header-content {
                max-width: 100%;
            }

            .reports-container {
                grid-template-columns: 1fr;
            }
            
            .pm-result-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .pm-result-stats {
                margin-top: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .card-container {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .header {
                padding: 20px;
                flex-direction: column;
                text-align: center;
            }
            
            .header-decoration {
                display: none;
            }
        }
        
        @media (max-width: 576px) {
            .card-container {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .calendar-grid {
                gap: 5px;
            }
            
            .calendar-day {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Animation -->
    <div class="loading-container">
        <div class="loading-shield"></div>
        <div class="loading-text">SISTEMA PMF</div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast-notification"></div>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-logo">
            <div class="logo-icon"></div>
            <h1>Sistema PMF</h1>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-item" data-view="dashboard-view">
                <div class="menu-icon">📊</div>
                <span>Dashboard</span>
            </div>
            <div class="menu-item" data-view="escalas-view">
                <div class="menu-icon">📆</div>
                <span>Escalas</span>
            </div>
            <div class="menu-item" data-view="militares-view">
                <div class="menu-icon">👮</div>
                <span>Militares</span>
            </div>
            <div class="menu-item active" data-view="relatorios-view">
                <div class="menu-icon">📝</div>
                <span>Relatórios</span>
            </div>
            <div class="menu-item" data-view="conflitos-view">
                <div class="menu-icon">⚠️</div>
                <span>Conflitos</span>
            </div>
            <div class="menu-item" data-view="busca-view">
                <div class="menu-icon">🔍</div>
                <span>Busca</span>
            </div>
            <div class="menu-item" data-view="config-view">
                <div class="menu-icon">⚙️</div>
                <span>Configurações</span>
            </div>
        </div>
        
        <div class="sidebar-footer">
            Sistema PMF v2.0 © 2024
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard View -->
        <div class="view" id="dashboard-view">
            <header class="header">
                <div class="header-content">
                    <h1>Sistema PMF</h1>
                    <p>Organize suas escalas de patrulhamento com eficiência e precisão</p>
                </div>
                <div class="header-decoration"></div>
            </header>
            
            <div class="card-container">
                <div class="card blue-card" id="total-days-card">
                    <div class="card-title">
                        Total de Dias Escalados
                        <span class="menu-icon">📅</span>
                    </div>
                    <div class="card-value" id="total-days-value">0</div>
                    <div class="card-chart">
                        <div class="chart-line"></div>
                    </div>
                </div>
                
                <div class="card green-card" id="pms-card">
                    <div class="card-title">
                        PMs Mobilizados
                        <span class="menu-icon">👮</span>
                    </div>
                    <div class="card-value" id="pms-value">0</div>
                    <div class="card-chart">
                        <div class="chart-line"></div>
                    </div>
                </div>
                
                <div class="card orange-card" id="average-card">
                    <div class="card-title">
                        Escalas por PM (Média)
                        <span class="menu-icon">📊</span>
                    </div>
                    <div class="card-value" id="average-value">0</div>
                    <div class="card-chart">
                        <div class="chart-line"></div>
                    </div>
                </div>
                
                <div class="card teal-card" id="occupation-card">
                    <div class="card-title">
                        Ocupação Mensal
                        <span class="menu-icon">📈</span>
                    </div>
                    <div class="card-value" id="occupation-value">0%</div>
                    <div class="card-chart">
                        <div class="chart-line"></div>
                    </div>
                </div>
            </div>
            
            <div class="section-container">
                <div class="section-header">
                    <div class="section-title">
                        <span class="menu-icon">📆</span>
                        Calendário de Escalas
                    </div>

                </div>
                
                <div class="calendar-content">
                    <div class="calendar-controls">
                        <button class="btn" id="prev-month-btn">◀ Mês Anterior</button>
                        <div class="month-display">
                            <span class="menu-icon">📅</span>
                            <span id="current-month">Maio 2025</span>
                        </div>
                        <button class="btn" id="next-month-btn">Próximo Mês ▶</button>
                    </div>
                    
                    <div class="calendar-grid" id="main-calendar-grid">
                        <div class="calendar-day-header">Dom</div>
                        <div class="calendar-day-header">Seg</div>
                        <div class="calendar-day-header">Ter</div>
                        <div class="calendar-day-header">Qua</div>
                        <div class="calendar-day-header">Qui</div>
                        <div class="calendar-day-header">Sex</div>
                        <div class="calendar-day-header">Sáb</div>
                        
                        <!-- Calendar days will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="section-container">
                <div class="section-header">
                    <div class="section-title">
                        <span class="menu-icon">👥</span>
                        Lista de Militares PMF
                    </div>
                    <button class="btn" id="add-pm-btn">+ Adicionar PM</button>
                </div>
                
                <div class="list-content">
                    <div class="list-filters">
                        <input type="text" class="filter-input" id="search-pm" placeholder="Buscar por nome...">
                        <select class="filter-input" id="filter-rank">
                            <option value="">Todas as guarnições</option>
                            <option value="soldier">Alfa</option>
                            <option value="officer">Bravo</option>
                            <option value="captain">Charlie</option>
                            <option value="expedient">Expediente</option>
                        </select>
                    </div>
                    
                    <table class="list-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Guarnição</th>
                                <th>Total de Escalas</th>
                                <th>Última Escala</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="pm-table-body">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Militares View -->
        <div class="view" id="militares-view">
            <header class="header">
                <div class="header-content">
                    <h1>Militares PMF</h1>
                    <p>Gerenciamento completo do efetivo policial</p>
                </div>
                <div class="header-decoration"></div>
            </header>
            
            <div class="section-container">
                <div class="section-header">
                    <div class="section-title">
                        <span class="menu-icon">👥</span>
                        Lista de Militares
                    </div>
                    <button class="btn" id="add-pm-btn-2">+ Adicionar PM</button>
                </div>
                
                <div class="list-content">
                    <div class="list-filters">
                        <input type="text" class="filter-input" id="search-pm-2" placeholder="Buscar por nome...">
                        <select class="filter-input" id="filter-rank-2">
                            <option value="">Todas as guarnições</option>
                            <option value="soldier">Alfa</option>
                            <option value="officer">Bravo</option>
                            <option value="captain">Charlie</option>
                            <option value="expedient">Expediente</option>
                        </select>
                    </div>
                    
                    <table class="list-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Guarnição</th>
                                <th>Total de Escalas</th>
                                <th>Última Escala</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="pm-table-body-2">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Escalas View -->
        <div class="view" id="escalas-view">
            <header class="header">
                <div class="header-content">
                    <h1>Escalas de Serviço</h1>
                    <p>Visualize e gerencie todas as escalas do efetivo</p>
                </div>
                <div class="header-decoration"></div>
            </header>
            
            <div class="section-container">
                <div class="section-header">
                    <div class="section-title">
                        <span class="menu-icon">📆</span>
                        Calendário Completo
                    </div>

                </div>
                
                <div class="calendar-content">
                    <div class="calendar-controls">
                        <button class="btn" id="prev-month-btn-2">◀ Mês Anterior</button>
                        <div class="month-display">
                            <span class="menu-icon">📅</span>
                            <span id="current-month-2">Maio 2025</span>
                        </div>
                        <button class="btn" id="next-month-btn-2">Próximo Mês ▶</button>
                    </div>
                    
                    <div class="calendar-grid" id="calendar-grid-2">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Relatórios View -->
        <div class="view active" id="relatorios-view">
            <header class="header">
                <div class="header-content">
                    <h1>Relatórios</h1>
                    <p>Estatísticas e análises detalhadas do sistema</p>
                </div>
                <div class="header-decoration"></div>
            </header>
            
            <div class="section-container">
                <div class="section-header">
                    <div class="section-title">
                        <span class="menu-icon">📊</span>
                        Análise de Operações
                    </div>
                    <div class="date-selector">
                        <label>Período:</label>
                        <select id="report-period" class="form-control">
                            <option value="month">Este Mês</option>
                            <option value="quarter">Último Trimestre</option>
                            <option value="year">Anual</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                </div>
                
                <div class="list-content">
                    <div class="reports-container">
                        <!-- Relatório de Extras -->
                        <div class="report-card">
                            <div class="report-header">
                                <div class="report-title">
                                    <span class="menu-icon">🕜</span>
                                    Relatório de Extras
                                </div>
                            </div>
                            <div class="report-content">
                                <div class="report-metric">
                                    <div class="metric-title">Total de Extras</div>
                                    <div class="metric-value">87</div>
                                    <div class="metric-subtitle">Extras registrados no período</div>
                                </div>

                                <div class="report-chart">
                                    <div class="bar-chart">
                                        <div class="chart-bar" style="height: 60%;">
                                            <div class="chart-bar-label">Alfa</div>
                                        </div>
                                        <div class="chart-bar" style="height: 85%;">
                                            <div class="chart-bar-label">Bravo</div>
                                        </div>
                                        <div class="chart-bar" style="height: 45%;">
                                            <div class="chart-bar-label">Charlie</div>
                                        </div>
                                        <div class="chart-bar" style="height: 30%;">
                                            <div class="chart-bar-label">Expediente</div>
                                        </div>
                                    </div>
                                    <div class="chart-axis"></div>
                                </div>

                                <div class="rank-breakdown">
                                    <div class="rank-item" id="alfa-count">
                                        <div class="rank-color" style="background-color: #3498db;"></div>
                                        <div class="rank-name">Alfa:</div>
                                        <div class="rank-count">0</div>
                                    </div>
                                    <div class="rank-item" id="bravo-count">
                                        <div class="rank-color" style="background-color: #f39c12;"></div>
                                        <div class="rank-name">Bravo:</div>
                                        <div class="rank-count">0</div>
                                    </div>
                                    <div class="rank-item" id="charlie-count">
                                        <div class="rank-color" style="background-color: #e74c3c;"></div>
                                        <div class="rank-name">Charlie:</div>
                                        <div class="rank-count">0</div>
                                    </div>
                                    <div class="rank-item" id="expediente-count">
                                        <div class="rank-color" style="background-color: #27ae60;"></div>
                                        <div class="rank-name">Expediente:</div>
                                        <div class="rank-count">0</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Militares com Mais Participações -->
                        <div class="report-card">
                            <div class="report-header">
                                <div class="report-title">
                                    <span class="menu-icon">🏆</span>
                                    Ranking de Participações
                                </div>
                            </div>
                            <div class="report-content">
                                <div class="report-metric">
                                    <div class="metric-title">Média por Militar</div>
                                    <div class="metric-value">5.8</div>
                                    <div class="metric-subtitle">Escalas por militar no período</div>
                                </div>

                                <table class="report-table">
                                    <thead>
                                        <tr>
                                            <th>Militar</th>
                                            <th>Guarnição</th>
                                            <th>Escalas</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Maria Oliveira</td>
                                            <td>Bravo</td>
                                            <td>12</td>
                                        </tr>
                                        <tr>
                                            <td>Carlos Pereira</td>
                                            <td>Charlie</td>
                                            <td>10</td>
                                        </tr>
                                        <tr>
                                            <td>João Silva</td>
                                            <td>Alfa</td>
                                            <td>9</td>
                                        </tr>
                                        <tr>
                                            <td>Ana Costa</td>
                                            <td>Expediente</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Pedro Santos</td>
                                            <td>Bravo</td>
                                            <td>7</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        


                    </div>
                </div>
            </div>
        </div>
        
        <!-- Conflitos View -->
        <div class="view" id="conflitos-view">
            <header class="header">
                <div class="header-content">
                    <h1>Conflitos de Escalas</h1>
                    <p>Detecta militares escalados simultaneamente no serviço ordinário e na operação PMF</p>
                </div>
                <div class="header-decoration"></div>
            </header>
            
            <div class="section-container">
                <div class="section-header">
                    <div class="section-title">
                        <span class="menu-icon">⚠️</span>
                        Detecção de Conflitos
                    </div>
                    <div class="date-selector">
                        <label>Período:</label>
                        <select id="conflict-period" class="form-control">
                            <option value="month">Este Mês</option>
                            <option value="next">Próximo Mês</option>
                        </select>
                    </div>
                </div>
                
                <div class="list-content">
                    <table class="list-table" id="conflicts-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Militar</th>
                                <th>Guarnição Ordinária</th>
                                <th>Operação Extra</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="conflicts-table-body">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Other Views (placeholder content) -->
        <div class="view" id="busca-view">
            <header class="header">
                <div class="header-content">
                    <h1>Busca Avançada</h1>
                    <p>Encontre informações específicas no sistema</p>
                </div>
                <div class="header-decoration"></div>
            </header>
            
            <div class="section-container">
                <div class="section-header">
                    <div class="section-title">
                        <span class="menu-icon">🔍</span>
                        Ferramenta de Busca
                    </div>
                </div>
                
                <div class="list-content">
                    <div class="list-filters">
                        <input type="text" class="filter-input" id="search-input" placeholder="Digite o nome do militar...">
                        <button class="btn" id="search-btn">Buscar</button>
                    </div>
                    
                    <!-- Resultados da busca -->
                    <div id="search-results" style="display: none;">
                        <div class="search-result-container">
                            <div class="search-result-header">
                                <h3>Resultados da Busca</h3>
                                <p id="search-count">0 resultados encontrados</p>
                            </div>
                            
                            <div id="search-results-list">
                                <!-- Resultados serão adicionados via JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mensagem quando não houver resultados -->
                    <div id="no-results" style="display: none;">
                        <p style="padding: 20px; color: var(--text-secondary);">Nenhum militar encontrado com este nome. Tente outro termo.</p>
                    </div>
                    
                    <!-- Mensagem inicial -->
                    <div id="initial-message">
                        <p style="padding: 20px; color: var(--text-secondary);">Digite o nome do militar para ver suas informações e histórico de escalas</p>
                    </div>
                </div>
            </div>
            
            <!-- Template para os resultados de busca -->
            <template id="pm-result-template">
                <div class="pm-result-card">
                    <div class="pm-result-header">
                        <div class="pm-result-info">
                            <h4 class="pm-result-name">Nome do Militar</h4>
                            <span class="rank-badge">Guarnição</span>
                        </div>
                        <div class="pm-result-stats">
                            <div class="pm-stat">
                                <span class="pm-stat-label">Total de Escalas:</span>
                                <span class="pm-stat-value">0</span>
                            </div>
                            <div class="pm-stat">
                                <span class="pm-stat-label">Última Escala:</span>
                                <span class="pm-stat-value">Nunca</span>
                            </div>
                        </div>
                        <button class="action-btn delete" title="Remover resultado">❌</button>
                    </div>
                    
                    <div class="pm-result-dates">
                        <h5>Datas das Escalas:</h5>
                        <div class="pm-dates-list">
                            <!-- Datas serão adicionadas via JavaScript -->
                        </div>
                    </div>
                </div>
            </template>
        </div>
        
        <div class="view" id="config-view">
            <header class="header">
                <div class="header-content">
                    <h1>Configurações</h1>
                    <p>Personalize seu Sistema PMF</p>
                </div>
                <div class="header-decoration"></div>
            </header>
            
            <div class="section-container">
                <div class="section-header">
                    <div class="section-title">
                        <span class="menu-icon">⚙️</span>
                        Opções do Sistema
                    </div>
                </div>
                
                <div class="list-content">
                    <p style="padding: 20px; color: var(--text-secondary);">Opções de configuração estarão disponíveis em breve</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add PM Modal -->
    <div class="modal-overlay" id="add-pm-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Adicionar Novo PM</div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nome</label>
                    <input type="text" class="form-control" id="pm-name">
                </div>
                <div class="form-group">
                    <label class="form-label">Guarnição</label>
                    <select class="form-control" id="pm-rank">
                        <option value="soldier">Alfa</option>
                        <option value="officer">Bravo</option>
                        <option value="captain">Charlie</option>
                        <option value="expedient">Expediente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Número de Identificação</label>
                    <input type="text" class="form-control" id="pm-id" placeholder="Ex: 12345">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-add-pm">Cancelar</button>
                <button class="btn" id="confirm-add-pm">Adicionar</button>
            </div>
        </div>
    </div>

    <!-- Add Schedule Modal -->
    <div class="modal-overlay" id="add-schedule-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Adicionar Nova Escala</div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Data</label>
                    <input type="date" class="form-control" id="schedule-date">
                </div>
                <div class="form-group">
                    <label class="form-label">Militar</label>
                    <select class="form-control" id="schedule-pm">
                        <!-- Will be populated by JavaScript -->
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-add-schedule">Cancelar</button>
                <button class="btn" id="confirm-add-schedule">Adicionar</button>
            </div>
        </div>
    </div>

    <!-- Day Details Modal -->
    <div class="modal-overlay" id="day-details-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="day-details-title">Escalas para 15/05/2025</div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="day-details-section">
                    <div class="day-details-title">Militares Escalados</div>
                    <div class="day-details-pm-list" id="day-details-pm-list">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    <div class="day-details-limit-warning" id="day-details-limit-warning" style="display: none;">
                        Máximo de 3 militares escalados para este dia!
                    </div>
                </div>
                <div class="form-group" id="day-add-pm-form">
                    <label class="form-label">Adicionar Militar</label>
                    <select class="form-control" id="day-details-pm-select">
                        <!-- Will be populated by JavaScript -->
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-day-details">Fechar</button>
                <button class="btn" id="add-pm-to-day">Adicionar</button>
            </div>
        </div>
    </div>

    <script>
        // Data model
        const app = {
            // State
            militares: [
                // All military personnel removed per client request
            ],
            schedules: [],
            currentMonth: new Date(),
            activeView: 'relatorios-view',
            selectedDate: null,
            MAX_PMS_PER_DAY: 3,
            // Referência de quando começou o ciclo de guarnição (uma quinta-feira passada)
            guarnicaoStartDate: new Date(2025, 0, 2), // 02/01/2025 - uma quinta-feira de referência
            
            // Initialization
            init() {
                this.setupEventListeners();
                this.renderMilitares();
                this.renderCalendars();
                this.updateDashboardMetrics();
                this.populatePMDropdown();
                this.updateReportData();
            },
            
            // Event listeners
            setupEventListeners() {
                // Sidebar navigation
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', () => {
                        this.changeView(item.dataset.view);
                    });
                });
                
                // Dashboard cards
                document.querySelectorAll('.card').forEach(card => {
                    card.addEventListener('click', () => {
                        this.showToast(`Detalhes de ${card.querySelector('.card-title').textContent.trim()}`, 'success');
                    });
                });
                
                // Calendar navigation
                document.getElementById('prev-month-btn').addEventListener('click', () => {
                    this.navigateMonth(-1);
                });
                
                document.getElementById('next-month-btn').addEventListener('click', () => {
                    this.navigateMonth(1);
                });
                
                document.getElementById('prev-month-btn-2').addEventListener('click', () => {
                    this.navigateMonth(-1);
                });
                
                document.getElementById('next-month-btn-2').addEventListener('click', () => {
                    this.navigateMonth(1);
                });
                
                // Add PM buttons
                document.getElementById('add-pm-btn').addEventListener('click', () => {
                    this.openModal('add-pm-modal');
                });
                
                document.getElementById('add-pm-btn-2').addEventListener('click', () => {
                    this.openModal('add-pm-modal');
                });
                
                // Add Schedule buttons removed per client request
                
                // Modal close buttons
                document.querySelectorAll('.modal-close').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.closeModal(e.target.closest('.modal-overlay').id);
                    });
                });
                
                // Cancel buttons
                document.getElementById('cancel-add-pm').addEventListener('click', () => {
                    this.closeModal('add-pm-modal');
                });
                
                document.getElementById('cancel-add-schedule').addEventListener('click', () => {
                    this.closeModal('add-schedule-modal');
                });
                
                document.getElementById('cancel-day-details').addEventListener('click', () => {
                    this.closeModal('day-details-modal');
                });
                
                // Confirm buttons
                document.getElementById('confirm-add-pm').addEventListener('click', () => {
                    this.addPM();
                });
                
                document.getElementById('confirm-add-schedule').addEventListener('click', () => {
                    this.addSchedule();
                });
                
                // Add PM to day button
                document.getElementById('add-pm-to-day').addEventListener('click', () => {
                    this.addPMToSelectedDay();
                });
                
                // Search and filter for PMs
                document.getElementById('search-pm').addEventListener('input', () => {
                    this.renderMilitares();
                });
                
                document.getElementById('filter-rank').addEventListener('change', () => {
                    this.renderMilitares();
                });
                
                document.getElementById('search-pm-2').addEventListener('input', () => {
                    const value = document.getElementById('search-pm-2').value;
                    document.getElementById('search-pm').value = value;
                    this.renderMilitares();
                });
                
                document.getElementById('filter-rank-2').addEventListener('change', () => {
                    const value = document.getElementById('filter-rank-2').value;
                    document.getElementById('filter-rank').value = value;
                    this.renderMilitares();
                });
                
                // Reports period change
                document.getElementById('report-period').addEventListener('change', () => {
                    this.updateReportData();
                    this.showToast('Período do relatório atualizado', 'success');
                });
                
                // Search functionality
                document.getElementById('search-btn').addEventListener('click', () => {
                    this.searchPM();
                });
                
                // Allow searching by pressing Enter
                document.getElementById('search-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.searchPM();
                    }
                });
            },
            
            // View management
            changeView(viewId) {
                document.querySelectorAll('.view').forEach(view => {
                    view.classList.remove('active');
                });
                document.getElementById(viewId).classList.add('active');
                
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`.menu-item[data-view="${viewId}"]`).classList.add('active');
                
                this.activeView = viewId;
                
                // Sync views when needed
                if (viewId === 'militares-view') {
                    document.getElementById('search-pm-2').value = document.getElementById('search-pm').value;
                    document.getElementById('filter-rank-2').value = document.getElementById('filter-rank').value;
                    this.renderMilitares();
                }
                
                if (viewId === 'escalas-view') {
                    this.renderCalendars(true);
                }
                
                // Update reports data when switching to that view
                if (viewId === 'relatorios-view') {
                    this.updateReportData();
                }
            },
            
            // Calendar functions
            formatMonthName(date) {
                const months = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                return `${months[date.getMonth()]} ${date.getFullYear()}`;
            },
            
            navigateMonth(offset) {
                const newMonth = new Date(this.currentMonth);
                newMonth.setMonth(newMonth.getMonth() + offset);
                this.currentMonth = newMonth;
                
                document.getElementById('current-month').textContent = this.formatMonthName(this.currentMonth);
                document.getElementById('current-month-2').textContent = this.formatMonthName(this.currentMonth);
                
                this.renderCalendars();
            },
            
            renderCalendars(forceEscalasView = false) {
                this.renderCalendar('main-calendar-grid');
                
                // Render the calendar for escalas view if on escalas view or if forced
                if (this.activeView === 'escalas-view' || forceEscalasView) {
                    this.renderCalendar('calendar-grid-2');
                }
            },
            
            // Determina qual guarnição está de serviço em uma data específica
            getGuarnicaoForDate(date) {
                // Converter para data se for string
                if (typeof date === 'string') {
                    const parts = date.split('-').map(num => parseInt(num));
                    date = new Date(parts[0], parts[1] - 1, parts[2]);
                }
                
                // Calcula quantas semanas se passaram desde a data de referência
                const referenceDate = new Date(this.guarnicaoStartDate);
                
                // Dias desde a data de referência
                const diffTime = date.getTime() - referenceDate.getTime();
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                // Determina qual ciclo estamos (0 = ALFA, 1 = BRAVO, 2 = CHARLIE)
                // Cada guarnição trabalha por 7 dias, resultando em um ciclo completo de 21 dias
                const cyclePosition = Math.floor((diffDays % 21) / 7);
                
                // Retorna a guarnição correspondente
                switch (cyclePosition) {
                    case 0: return 'alfa';
                    case 1: return 'bravo';
                    case 2: return 'charlie';
                    default: return 'alfa';
                }
            },
            
            renderCalendar(calendarGridId) {
                const calendarGrid = document.getElementById(calendarGridId);
                calendarGrid.innerHTML = '';
                
                // Add day headers
                const days = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
                days.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'calendar-day-header';
                    dayHeader.textContent = day;
                    calendarGrid.appendChild(dayHeader);
                });
                
                // Generate calendar days
                const year = this.currentMonth.getFullYear();
                const month = this.currentMonth.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                
                // Add empty cells for days before first day of month
                for (let i = 0; i < firstDay.getDay(); i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day';
                    calendarGrid.appendChild(emptyDay);
                }
                
                // Add days of the month
                for (let i = 1; i <= daysInMonth; i++) {
                    const dayCell = document.createElement('div');
                    dayCell.className = 'calendar-day';
                    
                    // Determine a guarnição para este dia
                    const currentDate = new Date(year, month, i);
                    const guarnicao = this.getGuarnicaoForDate(currentDate);
                    dayCell.classList.add(`guarnicao-${guarnicao}`);
                    
                    // Adiciona um indicador de guarnição
                    const guarnicaoLabel = document.createElement('div');
                    guarnicaoLabel.className = 'guarnicao-label';
                    guarnicaoLabel.textContent = guarnicao.toUpperCase();
                    guarnicaoLabel.style.fontSize = '0.7rem';
                    guarnicaoLabel.style.marginBottom = '4px';
                    guarnicaoLabel.style.fontWeight = 'bold';
                    guarnicaoLabel.style.opacity = '0.8';
                    dayCell.appendChild(guarnicaoLabel);
                    
                    // Day number
                    const dayNumber = document.createElement('div');
                    dayNumber.textContent = i;
                    dayCell.appendChild(dayNumber);
                    
                    // Format date string for comparison - ensure it uses UTC dates to avoid timezone issues
                    const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                    
                    // Count schedules for this date
                    const schedulesForDay = this.schedules.filter(schedule => 
                        schedule.date === dateStr
                    );
                    
                    if (schedulesForDay.length > 0) {
                        dayCell.classList.add('has-events');
                        
                        // Add counter
                        const countEl = document.createElement('div');
                        countEl.className = 'calendar-day-count';
                        countEl.textContent = `${schedulesForDay.length}/${this.MAX_PMS_PER_DAY}`;
                        dayCell.appendChild(countEl);

                        // Add PM names
                        const namesContainer = document.createElement('div');
                        namesContainer.className = 'calendar-pm-names';
                        
                        // Sort by rank (Captain > Officer > Soldier)
                        const sortedSchedules = [...schedulesForDay].sort((a, b) => {
                            const pmA = this.militares.find(pm => pm.id === a.pmId);
                            const pmB = this.militares.find(pm => pm.id === b.pmId);
                            if (!pmA || !pmB) return 0;

                            const rankOrder = { captain: 3, officer: 2, soldier: 1, expedient: 4 };
                            return rankOrder[pmB.rank] - rankOrder[pmA.rank];
                        });

                        sortedSchedules.forEach(schedule => {
                            const pm = this.militares.find(pm => pm.id === schedule.pmId);
                            if (!pm) return;

                            const pmItem = document.createElement('div');
                            pmItem.className = `calendar-pm-item ${pm.rank}`;
                            pmItem.textContent = pm.name;
                            namesContainer.appendChild(pmItem);
                        });
                        
                        dayCell.appendChild(namesContainer);
                    }
                    
                    // Handle click on day
                    dayCell.addEventListener('click', () => {
                        // Find all days in both calendars and remove active class
                        document.querySelectorAll('.calendar-day').forEach(d => {
                            d.classList.remove('active');
                        });
                        
                        // Find corresponding days in both calendars and add active class
                        if (dayCell.querySelector('div').textContent.trim() !== '') {
                            const dayNum = parseInt(dayCell.querySelector('div').textContent);
                            document.querySelectorAll('.calendar-day').forEach(d => {
                                if (d.querySelector('div') && parseInt(d.querySelector('div').textContent) === dayNum)
                                    d.classList.add('active');
                            });
                            
                            // Open day details modal
                            this.openDayDetails(dateStr);
                        }
                    });
                    
                    calendarGrid.appendChild(dayCell);
                }
                
                // Add empty cells for days after last day of month if needed
                const lastDayOfWeek = lastDay.getDay();
                if (lastDayOfWeek < 6) {
                    for (let i = lastDayOfWeek + 1; i <= 6; i++) {
                        const emptyDay = document.createElement('div');
                        emptyDay.className = 'calendar-day';
                        calendarGrid.appendChild(emptyDay);
                    }
                }
            },
            
            // Day Details functions
            openDayDetails(dateStr) {
                this.selectedDate = dateStr;
                
                // Format date for display - use the fixed formatDate method
                const formattedDate = this.formatDate(dateStr);
                
                // Set modal title
                document.getElementById('day-details-title').textContent = `Escalas para ${formattedDate}`;
                
                // Get PMs scheduled for this day
                const schedulesForDay = this.schedules.filter(schedule => schedule.date === dateStr);
                
                // Render scheduled PMs
                this.renderScheduledPMs(schedulesForDay);
                
                // Populate PM dropdown (excluding already scheduled PMs)
                this.populateDayDetailsPMDropdown(dateStr);
                
                // Check if at max capacity
                if (schedulesForDay.length >= this.MAX_PMS_PER_DAY) {
                    document.getElementById('day-details-limit-warning').style.display = 'block';
                    document.getElementById('day-add-pm-form').style.display = 'none';
                    document.getElementById('add-pm-to-day').style.display = 'none';
                } else {
                    document.getElementById('day-details-limit-warning').style.display = 'none';
                    document.getElementById('day-add-pm-form').style.display = 'block';
                    document.getElementById('add-pm-to-day').style.display = 'inline-flex';
                }
                
                // Open the modal
                this.openModal('day-details-modal');
            },
            
            renderScheduledPMs(schedulesForDay) {
                const container = document.getElementById('day-details-pm-list');
                container.innerHTML = '';
                
                if (schedulesForDay.length === 0) {
                    const emptyMessage = document.createElement('p');
                    emptyMessage.style.color = 'var(--text-secondary)';
                    emptyMessage.style.padding = '10px 0';
                    emptyMessage.id = 'empty-schedule-message';
                    emptyMessage.textContent = 'Nenhum militar escalado para este dia.';
                    container.appendChild(emptyMessage);
                    return;
                }
                
                // Hide empty message if it exists when new personnel are added
                const emptyMessage = document.getElementById('empty-schedule-message');
                if (emptyMessage) {
                    emptyMessage.style.display = 'none';
                }
                
                schedulesForDay.forEach(schedule => {
                    const pm = this.militares.find(pm => pm.id === schedule.pmId);
                    if (!pm) return;
                    
                    const item = document.createElement('div');
                    item.className = 'day-details-pm-item';
                    
                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'day-details-pm-name';
                    nameDiv.innerHTML = `
                        <span class="rank-badge rank-${pm.rank}">${this.getRankName(pm.rank)}</span>
                        <span>${pm.name}</span>
                    `;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'action-btn delete';
                    removeBtn.textContent = '❌';
                    removeBtn.addEventListener('click', () => {
                        this.removePMFromDay(schedule.id);
                    });
                    
                    item.appendChild(nameDiv);
                    item.appendChild(removeBtn);
                    container.appendChild(item);
                });
            },
            
            populateDayDetailsPMDropdown(dateStr) {
                const select = document.getElementById('day-details-pm-select');
                select.innerHTML = '';
                
                // Get already scheduled PMs for this day
                const scheduledPMIds = this.schedules
                    .filter(schedule => schedule.date === dateStr)
                    .map(schedule => schedule.pmId);
                
                // Filter out already scheduled PMs
                const availablePMs = this.militares.filter(pm => !scheduledPMIds.includes(pm.id));
                
                if (availablePMs.length === 0) {
                    const option = document.createElement('option');
                    option.disabled = true;
                    option.selected = true;
                    option.textContent = 'Todos os militares já estão escalados';
                    select.appendChild(option);
                    return;
                }
                
                availablePMs.forEach(pm => {
                    const option = document.createElement('option');
                    option.value = pm.id;
                    option.textContent = `${pm.name} (${this.getRankName(pm.rank)})`;
                    select.appendChild(option);
                });
            },
            
            addPMToSelectedDay() {
                if (!this.selectedDate) return;
                
                const pmSelect = document.getElementById('day-details-pm-select');
                const pmId = parseInt(pmSelect.value);
                
                // Check if we already have maximum PMs for this day
                const schedulesForDay = this.schedules.filter(schedule => schedule.date === this.selectedDate);
                if (schedulesForDay.length >= this.MAX_PMS_PER_DAY) {
                    this.showToast(`Máximo de ${this.MAX_PMS_PER_DAY} militares por dia atingido.`, 'error');
                    return;
                }
                
                // Create new schedule - using the selectedDate directly since it's already normalized
                const newSchedule = {
                    id: this.schedules.length + 1,
                    date: this.selectedDate,
                    pmId: pmId
                };
                
                // Add to schedules
                this.schedules.push(newSchedule);
                console.log('Added new schedule:', newSchedule);
                console.log('Total schedules now:', this.schedules.length);
                
                // Update UI
                this.renderCalendars();
                this.updateDashboardMetrics();
                this.renderMilitares();
                
                // Explicitly update reports data
                console.log('Updating reports after adding PM to selected day');
                this.updateReportData();
                
                // Refresh day details modal
                this.openDayDetails(this.selectedDate);
                
                // Show toast
                const pm = this.militares.find(pm => pm.id === pmId);
                this.showToast(`${pm.name} escalado para ${this.formatDate(this.selectedDate)}`, 'success');
            },
            
            removePMFromDay(scheduleId) {
                // Remove schedule
                this.schedules = this.schedules.filter(schedule => schedule.id !== scheduleId);
                
                // Update UI
                this.renderCalendars();
                this.updateDashboardMetrics();
                this.renderMilitares();
                
                // Explicitly update reports data
                this.updateReportData();
                
                // Refresh day details modal
                this.openDayDetails(this.selectedDate);
                
                // Show toast
                this.showToast(`Militar removido da escala`, 'success');
            },
            
            // PM management
            renderMilitares() {
                // Get filter values
                const searchQuery = document.getElementById('search-pm').value.toLowerCase();
                const rankFilter = document.getElementById('filter-rank').value;
                
                // Filter militares
                const filteredPMs = this.militares.filter(pm => {
                    const nameMatch = pm.name.toLowerCase().includes(searchQuery);
                    const rankMatch = !rankFilter || pm.rank === rankFilter;
                    return nameMatch && rankMatch;
                });
                
                // Clear existing rows
                const tbody = document.getElementById('pm-table-body');
                const tbody2 = document.getElementById('pm-table-body-2');
                tbody.innerHTML = '';
                tbody2.innerHTML = '';
                
                // Group by guarnição for the secondary view
                const pmsByGuarnição = {};
                filteredPMs.forEach(pm => {
                    if (!pmsByGuarnição[pm.rank]) {
                        pmsByGuarnição[pm.rank] = [];
                    }
                    pmsByGuarnição[pm.rank].push(pm);
                });

                // Render filtered PMs for main view
                filteredPMs.forEach(pm => {
                    const lastSchedule = this.getLastScheduleForPM(pm.id);
                    const totalSchedules = this.countSchedulesForPM(pm.id);
                    
                    const row = this.createPMTableRow(pm, lastSchedule, totalSchedules);
                    tbody.appendChild(row);
                });
                
                // Render grouped PMs by guarnição for militares view
                for (const rank in pmsByGuarnição) {
                    // Add header row for this guarnição
                    const headerRow = document.createElement('tr');
                    const headerCell = document.createElement('td');
                    headerCell.colSpan = 5;
                    headerCell.style.backgroundColor = 'rgba(20, 39, 65, 0.8)';
                    headerCell.style.fontWeight = 'bold';
                    headerCell.style.padding = '12px 20px';
                    headerCell.textContent = this.getRankName(rank);
                    headerRow.appendChild(headerCell);
                    tbody2.appendChild(headerRow);
                    
                    // Add rows for each PM in this guarnição
                    pmsByGuarnição[rank].forEach(pm => {
                        const lastSchedule = this.getLastScheduleForPM(pm.id);
                        const totalSchedules = this.countSchedulesForPM(pm.id);
                        
                        const row = this.createPMTableRow(pm, lastSchedule, totalSchedules);
                        tbody2.appendChild(row);
                    });
                }
            },
            
            createPMTableRow(pm, lastSchedule, totalSchedules) {
                const row = document.createElement('tr');
                
                // Name column
                const nameCell = document.createElement('td');
                nameCell.textContent = pm.name;
                row.appendChild(nameCell);
                
                // Rank column
                const rankCell = document.createElement('td');
                const rankBadge = document.createElement('span');
                rankBadge.className = `rank-badge rank-${pm.rank}`;
                rankBadge.textContent = this.getRankName(pm.rank);
                rankCell.appendChild(rankBadge);
                row.appendChild(rankCell);
                
                // Total schedules column
                const schedulesCell = document.createElement('td');
                schedulesCell.textContent = totalSchedules;
                row.appendChild(schedulesCell);
                
                // Last schedule column
                const lastScheduleCell = document.createElement('td');
                lastScheduleCell.textContent = lastSchedule ? this.formatDate(lastSchedule.date) : 'Não escalado';
                row.appendChild(lastScheduleCell);
                
                // Actions column
                const actionsCell = document.createElement('td');
                
                const editBtn = document.createElement('button');
                editBtn.className = 'action-btn edit';
                editBtn.textContent = '✏️';
                editBtn.addEventListener('click', () => {
                    this.showToast(`Editar ${pm.name}`, 'success');
                });
                actionsCell.appendChild(editBtn);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'action-btn delete';
                deleteBtn.textContent = '❌';
                deleteBtn.addEventListener('click', () => {
                    this.deletePM(pm.id);
                });
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(actionsCell);
                
                return row;
            },
            
            getLastScheduleForPM(pmId) {
                const pmSchedules = this.schedules.filter(schedule => schedule.pmId === pmId);
                if (pmSchedules.length === 0) return null;
                
                // Sort schedules by date (most recent first)
                pmSchedules.sort((a, b) => new Date(b.date) - new Date(a.date));
                return pmSchedules[0];
            },
            
            countSchedulesForPM(pmId) {
                return this.schedules.filter(schedule => schedule.pmId === pmId).length;
            },
            
            getRankName(rankCode) {
                const ranks = {
                    'soldier': 'Alfa',
                    'officer': 'Bravo',
                    'captain': 'Charlie',
                    'expedient': 'Expediente'
                };
                return ranks[rankCode] || 'Desconhecido';
            },
            
            formatDate(dateString) {
                // Ensure consistent timezone handling by explicitly setting the time to noon
                // and using UTC date components
                const date = new Date(dateString);
                const year = date.getUTCFullYear();
                const month = date.getUTCMonth();
                const day = date.getUTCDate();
                
                // Create a new date with explicit time to avoid timezone issues
                const fixedDate = new Date(Date.UTC(year, month, day, 12, 0, 0));
                return fixedDate.toLocaleDateString('pt-BR');
            },
            
            addPM() {
                const nameInput = document.getElementById('pm-name');
                const rankSelect = document.getElementById('pm-rank');
                
                if (!nameInput.value.trim()) {
                    this.showToast('Preencha o nome do PM', 'error');
                    return;
                }
                
                const newPM = {
                    id: this.militares.length + 1,
                    name: nameInput.value.trim(),
                    rank: rankSelect.value,
                    schedules: []
                };
                
                this.militares.push(newPM);
                this.renderMilitares();
                this.updateDashboardMetrics();
                this.populatePMDropdown();
                
                this.showToast(`${newPM.name} adicionado com sucesso`, 'success');
                this.closeModal('add-pm-modal');
                
                // Reset form
                nameInput.value = '';
                rankSelect.value = 'soldier';
            },
            
            deletePM(pmId) {
                if (confirm('Tem certeza que deseja remover este PM?')) {
                    // Remove PM from array
                    this.militares = this.militares.filter(pm => pm.id !== pmId);
                    
                    // Remove associated schedules
                    this.schedules = this.schedules.filter(schedule => schedule.pmId !== pmId);
                    
                    // Update UI
                    this.renderMilitares();
                    this.renderCalendars();
                    this.updateDashboardMetrics();
                    this.populatePMDropdown();
                    
                    this.showToast('PM removido com sucesso', 'success');
                }
            },
            
            populatePMDropdown() {
                const select = document.getElementById('schedule-pm');
                select.innerHTML = '';
                
                this.militares.forEach(pm => {
                    const option = document.createElement('option');
                    option.value = pm.id;
                    option.textContent = `${pm.name} (${this.getRankName(pm.rank)})`;
                    select.appendChild(option);
                });
            },
            
            // Schedule management
            addSchedule() {
                const dateInput = document.getElementById('schedule-date');
                const pmSelect = document.getElementById('schedule-pm');
                
                if (!dateInput.value) {
                    this.showToast('Selecione uma data', 'error');
                    return;
                }
                
                const pmId = parseInt(pmSelect.value);
                
                // Normalize date to ensure timezone consistency
                const inputDate = new Date(dateInput.value);
                const year = inputDate.getUTCFullYear();
                const month = (inputDate.getUTCMonth() + 1).toString().padStart(2, '0');
                const day = inputDate.getUTCDate().toString().padStart(2, '0');
                const dateStr = `${year}-${month}-${day}`;
                
                // Check if we already have maximum PMs for this day
                const schedulesForDay = this.schedules.filter(schedule => schedule.date === dateStr);
                if (schedulesForDay.length >= this.MAX_PMS_PER_DAY) {
                    this.showToast(`Máximo de ${this.MAX_PMS_PER_DAY} militares por dia atingido.`, 'error');
                    return;
                }
                
                // Check if this PM is already scheduled for this day
                const isPMScheduled = schedulesForDay.some(schedule => schedule.pmId === pmId);
                if (isPMScheduled) {
                    this.showToast('Este militar já está escalado para esta data.', 'error');
                    return;
                }
                
                const newSchedule = {
                    id: this.schedules.length + 1,
                    date: dateStr,
                    pmId: pmId
                };
                
                this.schedules.push(newSchedule);
                this.renderCalendars();
                this.updateDashboardMetrics();
                this.renderMilitares();
                
                // Explicitly update reports data
                this.updateReportData();
                
                const pm = this.militares.find(pm => pm.id === newSchedule.pmId);
                this.showToast(`Escala adicionada para ${pm.name}`, 'success');
                this.closeModal('add-schedule-modal');
                
                // Reset form
                dateInput.value = '';
            },
            
            // Dashboard metrics
            updateDashboardMetrics() {
                // Total days with schedules
                const uniqueDates = new Set();
                this.schedules.forEach(schedule => {
                    uniqueDates.add(schedule.date);
                });
                document.getElementById('total-days-value').textContent = uniqueDates.size;
                
                // Total PMs mobilized
                const uniquePMs = new Set();
                this.schedules.forEach(schedule => {
                    uniquePMs.add(schedule.pmId);
                });
                document.getElementById('pms-value').textContent = uniquePMs.size;
                
                // Average schedules per PM
                const average = this.militares.length > 0 ? 
                    (this.schedules.length / this.militares.length).toFixed(1) : 
                    '0';
                document.getElementById('average-value').textContent = average;
                
                // Monthly occupation
                const totalDays = new Date(
                    this.currentMonth.getFullYear(), 
                    this.currentMonth.getMonth() + 1, 
                    0
                ).getDate();
                const daysWithSchedules = this.countDaysWithSchedulesInCurrentMonth();
                const occupation = totalDays > 0 ? 
                    Math.round((daysWithSchedules / totalDays) * 100) : 
                    0;
                document.getElementById('occupation-value').textContent = `${occupation}%`;
                
                // Also update report data
                this.updateReportData();
            },
            
            countDaysWithSchedulesInCurrentMonth() {
                const uniqueDates = new Set();
                const year = this.currentMonth.getFullYear();
                const month = this.currentMonth.getMonth();
                
                this.schedules.forEach(schedule => {
                    const scheduleDate = new Date(schedule.date);
                    if (scheduleDate.getFullYear() === year && scheduleDate.getMonth() === month) {
                        uniqueDates.add(scheduleDate.getDate());
                    }
                });
                
                return uniqueDates.size;
            },
            
            // Report functions
            updateReportData() {
                console.log('Updating report data...');
                console.log('Current schedules:', this.schedules);
                
                // Calculate and update all report data
                this.updateExtrasReport();
                this.updateRankingReport();
                this.updateTimeDistributionReport();
                this.updateDatesReport();
                
                console.log('Report data updated');
            },
            
            // Get report data based on selected period
            getReportPeriodFilter() {
                const periodFilter = document.getElementById('report-period').value;
                const now = new Date();
                let startDate = new Date();
                
                switch(periodFilter) {
                    case 'month':
                        // Current month
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                    case 'quarter':
                        // Last 3 months
                        startDate = new Date(now.getFullYear(), now.getMonth() - 3, now.getDate());
                        break;
                    case 'year':
                        // Current year
                        startDate = new Date(now.getFullYear(), 0, 1);
                        break;
                    case 'custom':
                        // Use selected dates (defaults to current month if not implemented)
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                }
                
                return {
                    startDate: startDate,
                    endDate: now
                };
            },
            
            // Filter schedules by date range
            getSchedulesInPeriod(startDate, endDate) {
                // Create a debug log for schedules
                console.log('All schedules:', this.schedules);
                
                // Convert start and end dates to UTC for consistent comparison
                const utcStartDate = new Date(Date.UTC(startDate.getFullYear(), startDate.getMonth(), startDate.getDate()));
                const utcEndDate = new Date(Date.UTC(endDate.getFullYear(), endDate.getMonth(), endDate.getDate(), 23, 59, 59));
                
                console.log('Filtering schedules between:', utcStartDate, 'and', utcEndDate);
                
                const filteredSchedules = this.schedules.filter(schedule => {
                    // Parse the date string and convert to UTC for comparison
                    const dateComponents = schedule.date.split('-').map(num => parseInt(num));
                    const utcScheduleDate = new Date(Date.UTC(dateComponents[0], dateComponents[1] - 1, dateComponents[2]));
                    
                    const inRange = utcScheduleDate >= utcStartDate && utcScheduleDate <= utcEndDate;
                    return inRange;
                });
                
                console.log('Filtered schedules:', filteredSchedules);
                return filteredSchedules;
            },
            
            // Update Extras Report
            updateExtrasReport() {
                const { startDate, endDate } = this.getReportPeriodFilter();
                const filteredSchedules = this.getSchedulesInPeriod(startDate, endDate);
                
                // Count total extras
                const metricsElements = document.querySelectorAll('.report-metric .metric-value');
                if (metricsElements && metricsElements.length > 0) {
                    metricsElements[0].textContent = filteredSchedules.length;
                }
                
                console.log('Updating extras report with', filteredSchedules.length, 'schedules');
                
                // Count extras by rank/guarnição
                const extrasByRank = {
                    soldier: 0,    // Alfa
                    officer: 0,    // Bravo
                    captain: 0,    // Charlie
                    expedient: 0   // Expediente
                };
                
                console.log('Checking rank count in updateExtrasReport');
                
                filteredSchedules.forEach(schedule => {
                    const pm = this.militares.find(pm => pm.id === schedule.pmId);
                    if (pm) {
                        console.log('Found PM for schedule:', pm.name, 'with rank:', pm.rank);
                        extrasByRank[pm.rank]++;
                    } else {
                        console.log('PM not found for schedule ID:', schedule.pmId);
                    }
                });
                
                console.log('Extras by rank after counting:', JSON.stringify(extrasByRank));
                
                // Update chart bars
                const chartBars = document.querySelectorAll('.bar-chart .chart-bar');
                const totalExtras = filteredSchedules.length;
                
                console.log('Updating chart bars with total extras:', totalExtras);
                
                if (totalExtras > 0) {
                    // Find the max count for better scaling
                    const maxCount = Math.max(
                        extrasByRank.soldier,
                        extrasByRank.officer,
                        extrasByRank.captain,
                        extrasByRank.expedient
                    );
                    
                    console.log('Max rank count:', maxCount);
                    
                    // If there are extras but no max count, something is wrong
                    if (maxCount === 0) {
                        console.warn('Warning: Extras exist but all ranks have 0 count');
                    }
                    
                    // Calculate percentages based on max count for better visualization
                    // This gives better relative scaling between bars
                    const soldierPercent = maxCount > 0 ? Math.round((extrasByRank.soldier / maxCount) * 100) : 0;
                    const officerPercent = maxCount > 0 ? Math.round((extrasByRank.officer / maxCount) * 100) : 0;
                    const captainPercent = maxCount > 0 ? Math.round((extrasByRank.captain / maxCount) * 100) : 0;
                    const expedientPercent = maxCount > 0 ? Math.round((extrasByRank.expedient / maxCount) * 100) : 0;
                    
                    console.log('Bar percentages:', soldierPercent, officerPercent, captainPercent, expedientPercent);
                    
                    // Set minimum height of 5% for visibility
                    chartBars[0].style.height = `${Math.max(5, soldierPercent)}%`;
                    chartBars[1].style.height = `${Math.max(5, officerPercent)}%`;
                    chartBars[2].style.height = `${Math.max(5, captainPercent)}%`;
                    chartBars[3].style.height = `${Math.max(5, expedientPercent)}%`;
                } else {
                    // Set all bars to minimum height if no data
                    chartBars.forEach(bar => bar.style.height = '5%');
                }
                
                // Update breakdown counts with proper ID selectors
                document.querySelector('#alfa-count .rank-count').textContent = extrasByRank.soldier;
                document.querySelector('#bravo-count .rank-count').textContent = extrasByRank.officer;
                document.querySelector('#charlie-count .rank-count').textContent = extrasByRank.captain;
                document.querySelector('#expediente-count .rank-count').textContent = extrasByRank.expedient;
                
                console.log('Updated rank counts on UI:', 
                    extrasByRank.soldier, 
                    extrasByRank.officer, 
                    extrasByRank.captain, 
                    extrasByRank.expedient);
            },
            
            // Update Ranking Report
            updateRankingReport() {
                const { startDate, endDate } = this.getReportPeriodFilter();
                const filteredSchedules = this.getSchedulesInPeriod(startDate, endDate);
                
                // Count schedules per PM
                const schedulesPerPM = {};
                
                filteredSchedules.forEach(schedule => {
                    if (!schedulesPerPM[schedule.pmId]) {
                        schedulesPerPM[schedule.pmId] = 0;
                    }
                    schedulesPerPM[schedule.pmId]++;
                });
                
                // Calculate average
                const participatingPMs = Object.keys(schedulesPerPM).length;
                const avgPerPM = participatingPMs > 0 
                    ? (filteredSchedules.length / participatingPMs).toFixed(1)
                    : '0';
                
                document.querySelectorAll('.report-metric .metric-value')[1].textContent = avgPerPM;
                
                // Create ranking data
                const rankingData = Object.keys(schedulesPerPM).map(pmId => {
                    const pm = this.militares.find(pm => pm.id === parseInt(pmId));
                    return {
                        id: parseInt(pmId),
                        name: pm ? pm.name : 'Desconhecido',
                        rank: pm ? pm.rank : 'unknown',
                        count: schedulesPerPM[pmId]
                    };
                });
                
                // Sort by count (descending)
                rankingData.sort((a, b) => b.count - a.count);
                
                // Get table body
                const rankingTable = document.querySelectorAll('.report-table')[0];
                const tbody = rankingTable.querySelector('tbody');
                tbody.innerHTML = '';
                
                // Add top 5 (or fewer if not available)
                const topCount = Math.min(5, rankingData.length);
                
                for (let i = 0; i < topCount; i++) {
                    const pm = rankingData[i];
                    const row = document.createElement('tr');
                    
                    const nameCell = document.createElement('td');
                    nameCell.textContent = pm.name;
                    
                    const rankCell = document.createElement('td');
                    rankCell.textContent = this.getRankName(pm.rank);
                    
                    const countCell = document.createElement('td');
                    countCell.textContent = pm.count;
                    
                    row.appendChild(nameCell);
                    row.appendChild(rankCell);
                    row.appendChild(countCell);
                    
                    tbody.appendChild(row);
                }
                
                // Add empty rows if needed
                for (let i = topCount; i < 5; i++) {
                    const row = document.createElement('tr');
                    
                    const nameCell = document.createElement('td');
                    nameCell.textContent = '-';
                    
                    const rankCell = document.createElement('td');
                    rankCell.textContent = '-';
                    
                    const countCell = document.createElement('td');
                    countCell.textContent = '0';
                    
                    row.appendChild(nameCell);
                    row.appendChild(rankCell);
                    row.appendChild(countCell);
                    
                    tbody.appendChild(row);
                }
            },
            
            // Update Time Distribution Report
            updateTimeDistributionReport() {
                const { startDate, endDate } = this.getReportPeriodFilter();
                const filteredSchedules = this.getSchedulesInPeriod(startDate, endDate);
                
                // Count unique days with schedules
                const uniqueDates = new Set();
                filteredSchedules.forEach(schedule => {
                    uniqueDates.add(schedule.date);
                });
                
                document.querySelectorAll('.report-metric .metric-value')[2].textContent = uniqueDates.size;
                
                // Count schedules by day of week
                const dayOfWeekCounts = [0, 0, 0, 0, 0, 0, 0]; // Sun, Mon, Tue, Wed, Thu, Fri, Sat
                
                filteredSchedules.forEach(schedule => {
                    const date = new Date(schedule.date);
                    const dayOfWeek = date.getDay(); // 0-6
                    dayOfWeekCounts[dayOfWeek]++;
                });
                
                // Find max count for scaling
                const maxDayCount = Math.max(...dayOfWeekCounts);
                
                // Update bar chart
                const dayBars = document.querySelectorAll('.report-chart:nth-of-type(2) .bar-chart .chart-bar');
                
                if (maxDayCount > 0) {
                    dayOfWeekCounts.forEach((count, index) => {
                        const heightPercent = Math.round((count / maxDayCount) * 100);
                        dayBars[index].style.height = `${Math.max(5, heightPercent)}%`;
                    });
                } else {
                    dayBars.forEach(bar => bar.style.height = '5%');
                }
                
                // Find most frequent day
                let mostFrequentDayIndex = 0;
                for (let i = 1; i < 7; i++) {
                    if (dayOfWeekCounts[i] > dayOfWeekCounts[mostFrequentDayIndex]) {
                        mostFrequentDayIndex = i;
                    }
                }
                
                const dayNames = ['Domingo', 'Segunda-feira', 'Terça-feira', 'Quarta-feira', 
                                  'Quinta-feira', 'Sexta-feira', 'Sábado'];
                
                // Update most frequent day
                const frequentDayElement = document.querySelector('.rank-breakdown:nth-of-type(2) .rank-count');
                frequentDayElement.textContent = dayOfWeekCounts[mostFrequentDayIndex] > 0 
                    ? dayNames[mostFrequentDayIndex] 
                    : 'Nenhum';
            },
            
            // Update Dates Report
            updateDatesReport() {
                const { startDate, endDate } = this.getReportPeriodFilter();
                const filteredSchedules = this.getSchedulesInPeriod(startDate, endDate);
                
                // Group schedules by date
                const schedulesByDate = {};
                
                console.log('Updating dates report with filtered schedules:', filteredSchedules);
                
                filteredSchedules.forEach(schedule => {
                    if (!schedulesByDate[schedule.date]) {
                        schedulesByDate[schedule.date] = {
                            date: schedule.date,
                            pmIds: [],
                            ranks: new Set()
                        };
                    }
                    
                    const dateData = schedulesByDate[schedule.date];
                    dateData.pmIds.push(schedule.pmId);
                    
                    const pm = this.militares.find(pm => pm.id === schedule.pmId);
                    if (pm) {
                        console.log('Found PM for schedule:', pm.name, pm.rank);
                        dateData.ranks.add(pm.rank);
                    } else {
                        console.log('Warning: PM not found for ID:', schedule.pmId);
                    }
                });
                
                // Convert to array and sort by date (most recent first)
                const datesArray = Object.values(schedulesByDate);
                datesArray.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Update total dates
                document.querySelectorAll('.report-metric .metric-value')[3].textContent = datesArray.length;
                
                // Get table body
                const datesTable = document.querySelectorAll('.report-table')[1];
                const tbody = datesTable.querySelector('tbody');
                tbody.innerHTML = '';
                
                // Add up to 5 most recent dates
                const displayCount = Math.min(5, datesArray.length);
                
                for (let i = 0; i < displayCount; i++) {
                    const dateData = datesArray[i];
                    const row = document.createElement('tr');
                    
                    // Formatted date
                    const dateCell = document.createElement('td');
                    dateCell.textContent = this.formatDate(dateData.date);
                    
                    // Number of militares
                    const militaresCell = document.createElement('td');
                    militaresCell.textContent = dateData.pmIds.length;
                    
                    // Primary guarnição for this date
                    const rankCell = document.createElement('td');
                    
                    // Find most represented rank/guarnição
                    const rankCounts = { soldier: 0, officer: 0, captain: 0, expedient: 0 };
                    
                    dateData.pmIds.forEach(pmId => {
                        const pm = this.militares.find(pm => pm.id === pmId);
                        if (pm) {
                            rankCounts[pm.rank]++;
                        }
                    });
                    
                    let primaryRank = 'soldier';
                    let maxCount = 0;
                    
                    for (const rank in rankCounts) {
                        if (rankCounts[rank] > maxCount) {
                            maxCount = rankCounts[rank];
                            primaryRank = rank;
                        }
                    }
                    
                    rankCell.textContent = this.getRankName(primaryRank);
                    
                    row.appendChild(dateCell);
                    row.appendChild(militaresCell);
                    row.appendChild(rankCell);
                    
                    tbody.appendChild(row);
                }
                
                // Add empty rows if needed
                for (let i = displayCount; i < 5; i++) {
                    const row = document.createElement('tr');
                    
                    const dateCell = document.createElement('td');
                    dateCell.textContent = '-';
                    
                    const militaresCell = document.createElement('td');
                    militaresCell.textContent = '0';
                    
                    const rankCell = document.createElement('td');
                    rankCell.textContent = '-';
                    
                    row.appendChild(dateCell);
                    row.appendChild(militaresCell);
                    row.appendChild(rankCell);
                    
                    tbody.appendChild(row);
                }
            },
            
            // Search functionality
            searchPM() {
                const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
                
                if (!searchTerm) {
                    this.showToast('Digite um nome para buscar', 'error');
                    return;
                }
                
                // Find matching PMs by name
                const matchingPMs = this.militares.filter(pm => 
                    pm.name.toLowerCase().includes(searchTerm)
                );
                
                // Update UI based on results
                const resultsContainer = document.getElementById('search-results');
                const noResultsMessage = document.getElementById('no-results');
                const initialMessage = document.getElementById('initial-message');
                const resultsCount = document.getElementById('search-count');
                const resultsList = document.getElementById('search-results-list');
                
                // Clear previous results
                resultsList.innerHTML = '';
                
                // Hide all message containers initially
                resultsContainer.style.display = 'none';
                noResultsMessage.style.display = 'none';
                initialMessage.style.display = 'none';
                
                if (matchingPMs.length === 0) {
                    // No results found
                    noResultsMessage.style.display = 'block';
                    return;
                }
                
                // Display results count
                resultsCount.textContent = `${matchingPMs.length} ${matchingPMs.length === 1 ? 'resultado encontrado' : 'resultados encontrados'}`;
                resultsContainer.style.display = 'block';
                
                // Add each matching PM to the results
                matchingPMs.forEach(pm => {
                    // Get PM's schedules
                    const pmSchedules = this.schedules.filter(schedule => schedule.pmId === pm.id);
                    
                    // Format dates for display, sorted newest first
                    // Use UTC dates to ensure consistent sorting regardless of timezone
                    const scheduleDates = pmSchedules
                        .map(schedule => schedule.date)
                        .sort((a, b) => {
                            const dateA = new Date(a);
                            const dateB = new Date(b);
                            return Date.UTC(dateB.getFullYear(), dateB.getMonth(), dateB.getDate()) - 
                                   Date.UTC(dateA.getFullYear(), dateA.getMonth(), dateA.getDate());
                        });
                    
                    // Get last schedule date
                    const lastSchedule = scheduleDates.length > 0 
                        ? this.formatDate(scheduleDates[0])
                        : 'Não escalado';
                    
                    // Clone the template
                    const template = document.getElementById('pm-result-template');
                    const resultNode = document.importNode(template.content, true);
                    
                    // Fill in the data
                    resultNode.querySelector('.pm-result-name').textContent = pm.name;
                    resultNode.querySelector('.rank-badge').textContent = this.getRankName(pm.rank);
                    resultNode.querySelector('.rank-badge').classList.add(`rank-${pm.rank}`);
                    
                    // Set stats
                    const statValues = resultNode.querySelectorAll('.pm-stat-value');
                    statValues[0].textContent = scheduleDates.length;
                    statValues[1].textContent = lastSchedule;
                    
                    // Setup delete button
                    const deleteButton = resultNode.querySelector('.action-btn.delete');
                    deleteButton.addEventListener('click', (e) => {
                        // Get the parent result card
                        const resultCard = e.target.closest('.pm-result-card');
                        // Remove it
                        if (resultCard) {
                            resultCard.remove();
                            
                            // Check if there are any results left
                            const remainingResults = resultsList.querySelectorAll('.pm-result-card').length;
                            if (remainingResults === 0) {
                                // No results left, show initial message
                                resultsContainer.style.display = 'none';
                                initialMessage.style.display = 'block';
                            } else {
                                // Update result count
                                resultsCount.textContent = `${remainingResults} ${remainingResults === 1 ? 'resultado encontrado' : 'resultados encontrados'}`;
                            }
                            
                            this.showToast('Resultado removido', 'success');
                        }
                    });
                    
                    // Add dates
                    const datesList = resultNode.querySelector('.pm-dates-list');
                    
                    if (scheduleDates.length === 0) {
                        const noDateMessage = document.createElement('p');
                        noDateMessage.style.color = 'var(--text-secondary)';
                        noDateMessage.textContent = 'Nenhuma escala registrada';
                        datesList.appendChild(noDateMessage);
                    } else {
                        scheduleDates.forEach(dateStr => {
                            const dateItem = document.createElement('span');
                            dateItem.className = 'pm-date-item';
                            dateItem.textContent = this.formatDate(dateStr);
                            datesList.appendChild(dateItem);
                        });
                    }
                    
                    // Add to results list
                    resultsList.appendChild(resultNode);
                });
            },
            
            // UI utilities
            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            },
            
            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            },
            
            showToast(message, type = '') {
                const toast = document.getElementById('toast-notification');
                toast.textContent = message;
                toast.className = 'toast';
                if (type) toast.classList.add(type);
                
                // Show the toast
                setTimeout(() => toast.classList.add('visible'), 10);
                
                // Hide the toast after 3 seconds
                setTimeout(() => {
                    toast.classList.remove('visible');
                }, 3000);
            }
        };
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // The loading screen will automatically fade out due to the CSS animation
            app.init();
        });
    </script>
    <!-- Script para depuração da API -->
    <script src="debug-api.js"></script>
    <!-- Script para verificar API e conexão com banco de dados -->
    <script src="api-check.js"></script>
</body>
</html>